<div fxLayout="column" fxLayoutAlign="center" class="flexcolumn">
  <section class="titleheader mat-typography">
    <div fxLayout="row" fxLayout.lt-sm="column" fxLayoutAlign="space-around center">
      <div fxFlex="0 0 40%" fxFlex.lt-sm="0 0 60%" fxFlex.gt-lg="0 0 30%">
        <img class="margin-top-10 logo-wv" src="assets/img/logowv.png" alt="World Vision">
      </div>
    </div>
    <h2 *ngIf="titleheader" class="text-blue text-bold margin-top-20">
      Formulario de identificación de familias migrantes venezolanas, colombianas retornadas y comunidades de acogida.
    </h2>
    <h2 *ngIf="thanksmessage || finishmessage" class="margin-top-20">¡Gracias por participar!</h2>
    <h3 class="text-bold" *ngIf="thanksmessage && form === 1">
      Si eres preseleccionado/a World Vision se comunicará contigo
    </h3>
    <h3 class="text-bold margin-bottom-0" *ngIf="thanksmessage">
      Recuerda:
    </h3>
    <h3 class="text-bold" *ngIf="thanksmessage">
      En World Vision no cobramos ni pedimos remuneración por ningún servicio a la comunidad, no tenemos intermediarios.
    </h3>
  </section>
  <section *ngIf="termnsandconditions" fxLayout="row">
    <div class="termnsandconditions" fxFlex="100%">
      <h3 class="text-underline">Términos de participación</h3>
      <p class="text-bold text-red">
        Este proceso es gratuito.
      </p>
      <p class="text-bold">
        ¡Tu participación es voluntaria!
      </p>
      <p class="text-bold">
        Esta iniciativa de identificación de familias vulnerables es realizada hasta enero de 2021.
      </p>
      <p class="text-bold">
        Ten presente que si algún miembro de tu familia ya se registró o hizo parte del proyecto
        <span class="text-blue">#VenEsperanza</span> no se podrá volver a registrar.
      </p>
      <p class="text-bold">
        Puedes decidir no participar o retirarte en cualquier momento.
      </p>
      <p class="text-bold">
        La información brindada no tendrá ninguna implicación en tu condición migratoria.
      </p>
      <p class="text-bold">
        Este proceso de identificación está únicamente habilitado de forma virtual para los usuarios de Facebook
        ubicados en Villa del Rosario. Si el enlace del formulario fue compartido, copiado o reenviado, no podrás
        ingresar.
      </p>
      <p>
        El objetivo de esta encuesta es valorar si es posible que seas elegido para ingresar a programas de asistencia
        humanitaria.
      </p>
      <p>
        Estos programas pueden incluir asistencia multipropósito, servicios de protección y otros servicios
        humanitarios.
      </p>
      <p>
        Responder a estas preguntas no quiere decir que tú y tu familia serán automáticamente seleccionados. Si eres
        preseleccionado, serás contactado por la organización para continuar con el proceso.
      </p>
      <p>
        Tu información es confidencial, sin embargo, la organización podría tener que compartir parte de tus datos, de
        manera segura, con otras organizaciones. Estas podrían ser nuestro donante, las Naciones Unidas y ONG’s
        nacionales e internacionales. Esto con el fin de no tener posibles casos duplicados, de fraude o para referir tu
        hogar a servicios adicionales, y contribuir en iniciativas de investigación conjuntas de carácter humanitario.
      </p>
      <p>
        Este proceso de identificación de datos incluye preguntas sobre tu situación actual. La información que
        entregues será verificada por la organización.
      </p>
      <p class="text-bold">
        Por favor responde con tus datos reales.
      </p>
      <h3 class="text-underline">Autorización para el tratamiento de Datos Personales</h3>
      <p>
        Cuando haces clic en la casilla “Si autorizo”, aceptas el tratamiento de tus datos personales a Visión Mundial
        Internacional, como responsable de tu información, para las siguientes finalidades:
      </p>
      <ul>
        <li>Validar los requisitos que determinarán si eres elegible para recibir los beneficios del programa.</li>
        <li>Identificar si eres un posible participante del programa.</li>
        <li>Entregar vía telefónica o por medios digitales información adicional para que puedas participar en el
          programa.
        </li>
        <li>Confirmar tus datos personales.</li>
        <li>Recibir asistencias multipropósito en caso de seas seleccionado como participante del programa.</li>
        <li>Hacer parte de la base de datos de familias vulnerables afectadas por la crisis migratoria.</li>
        <li>Participar en encuestas para identificar elementos de vulnerabilidad de la población beneficiaria.</li>
        <li>Participar en investigaciones, análisis o prestación de servicio humanitario.</li>
        <li>Recibir comunicaciones físicas y/o electrónicas.</li>
      </ul>
      <p>
        Entiendo que me pueden llegar a realizar preguntas relacionadas con datos personales sensibles y datos
        personales de mi núcleo familiar. Me han informado que no me encuentro obligado a suministrar dichos datos
        personales. No obstante, se me ha explicado la importancia de suministrar dicha información con el propósito de
        poder acceder a los beneficios del programa.
      </p>
      <p>
        Entiendo y autorizo el tratamiento de mis datos personales y los datos personales de mi núcleo familiar, quienes
        previamente me han otorgado su autorización para entregar sus datos personales, para la posibilidad de
        participar en el programa, según las finalidades aquí descritas.
      </p>
      <p>
        Autorizo y entiendo que la información personal que suministro será almacenada en servidores externos a cargo de
        terceros en un país que tiene un nivel adecuado de seguridad de los datos, y que mi información personal puede
        llegar a ser transmitida a otras organizaciones que participan en el programa, conforme a lo establecido en la
        Política de Tratamiento de Datos Personales.
      </p>
      <p>
        Declaro que Visión Mundial Internacional ha puesto en mi conocimiento, el derecho que poseo como titular de la
        información entregada, de recibir en cualquier momento información acerca del tratamiento dado a los datos
        entregados, y/o de solicitar la actualización, rectificación, y/o supresión de los datos personales
        recolectados, o la revocatoria de la autorización otorgada, lo cual podré solicitar mediante un correo
        electrónico enviado a juridica_colombia@wvi.org , o a través de una comunicación dirigida a la sede principal
        ubicada en la Cra. 7 No. 60 a –24 de la ciudad de Bogotá D.C.
      </p>
      <p class="url-text">
        Conozco que Visión Mundial Internacional para efectos del presente programa, cuenta con una política de
        Protección de Datos Personales la cual podré consultar en la página web
        <a target="_blank" href="https://venesperanza.immap.org/assets/politica_tratamiento_informacion_personal.pdf">
          https://venesperanza.immap.org/assets/politica_tratamiento_informacion_personal.pdf</a>.
      </p>
    </div>
  </section>
  <div *ngIf="form && quentionaccepttermns">
    <p>
      <mat-checkbox class="example-margin" color="primary" (change)="toggleAutorTrat($event)">
      </mat-checkbox>
      Autorizo el tratamiento de mis datos personales, conforme a lo informado previamente.
    </p>
    <p>
      <mat-checkbox class="example-margin" color="primary" (change)="toggleAutorCond($event)">
      </mat-checkbox>
      Entiendo y acepto los términos y condiciones establecidos para participar en el programa.
    </p>
    <h3 *ngIf="autorizationPolicy && autorizationConditions" class="text-bold text-blue">
      ¿Estás de acuerdo con las condiciones explicadas?
    </h3>
    <div *ngIf="autorizationPolicy && autorizationConditions" class="margin-top-20 text-center">
      <button mat-raised-button color="primary" (click)="termsAccept(true)" class="accept-button">SI</button>
      <button mat-raised-button (click)="termsAccept(false)">NO</button>
    </div>
  </div>
  <div *ngIf="!form" class="margin-top-20 text-center">
    <mat-spinner></mat-spinner>
  </div>
  <div class="card-container" *ngIf="formPrincipal" fxLayout="row">
    <mat-vertical-stepper [(linear)]="isLinear" (selectionChange)="stepChange($event, stepper)" #stepper
                          fxFlex="100%">
      <mat-step [stepControl]="secondFormGroup">
        <form [formGroup]="secondFormGroup">
          <ng-template matStepLabel>DATOS DEL ENCUESTADO</ng-template>
          <mat-form-field>
            <mat-label>Primer Nombre</mat-label>
            <input matInput placeholder="Primer Nombre" formControlName="firstNameCtrl" required>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Segundo Nombre</mat-label>
            <input matInput placeholder="Segundo Nombre" formControlName="secondNameCtrl">
          </mat-form-field>
          <mat-form-field>
            <mat-label>Primer Apellido</mat-label>
            <input matInput placeholder="Primer Apellido" formControlName="lastNameCtrl" required>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Segundo Apellido</mat-label>
            <input matInput placeholder="Segundo Apellido" formControlName="secondLastNameCtrl">
          </mat-form-field>
          <div>
            <p>Sexo*:</p>
            <mat-radio-group aria-label="Selecciona una opción" formControlName="sexoCtrl"
                             (change)="seleccionSexo('principal')" required>
              <mat-radio-button value="mujer">Mujer</mat-radio-button>
              <mat-radio-button value="hombre">Hombre</mat-radio-button>
            </mat-radio-group>
          </div>
          <mat-form-field>
            <mat-label>Fecha de Nacimiento</mat-label>
            <input matInput [matDatepicker]="picker" [max]="myDate" formControlName="fechaNacimientoCtrl" required>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Nacionalidad:</mat-label>
            <mat-select formControlName="nacionalidadCtrl" required>
              <mat-option *ngFor="let nacionalidad of nacionalidades" [value]="nacionalidad.name">
                {{nacionalidad.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Tipo de Documento:</mat-label>
            <mat-select formControlName="tipoDocumentoCtrl" (selectionChange)="selectTipoDocumento($event)" required>
              <mat-option *ngFor="let documento of tipoDocumentos" [value]="documento.name">
                {{documento.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field *ngIf="otroTipoDocumento">
            <mat-label>¿Cuál? *(Indicar tipo, ejemplo: pasaporte)*</mat-label>
            <input matInput placeholder="Ejemplo: Pasaporte" formControlName="otroTipoDocumentoCtrl" required>
          </mat-form-field>
          <mat-form-field *ngIf="numeroDocumento">
            <mat-label>Número de Documento</mat-label>
            <input matInput placeholder="Número de Documento" type="number" formControlName="numeroDocumentoCtrl"
                   required minlength="3">
          </mat-form-field>
          <div *ngIf="secondFormGroup.status == 'VALID'">
            <button color="primary" mat-raised-button [disabled]="saving"
                    (click)="enviarInfo(secondFormGroup,'paso1',stepper,true,stepper, false)">
              {{saving ? 'Guardando...' : 'Siguiente'}}
            </button>
            <p>
              Oprime el botón "Siguiente" para salvar la información e ir al siguiente paso.
            </p>
          </div>
          <p *ngIf="secondFormGroup.status != 'VALID'"><span class="text-red text-bold">*</span>Pregunta obligatoria</p>
          <p class="text-blue text-bold">#VenEsperanza</p>
        </form>
      </mat-step>
      <mat-step [stepControl]="thirdFormGroup">
        <form [formGroup]="thirdFormGroup">
          <ng-template matStepLabel>DATOS GEOGRÁFICOS Y DE CONTACTO</ng-template>
          <mat-form-field>
            <mat-label>Departamento:</mat-label>
            <mat-select formControlName="departamentoCtrl" (selectionChange)="selectDepartamento($event)" required>
              <mat-option *ngFor="let departamento of departamentosList" [value]="departamento.id">
                {{departamento.nombre}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Municipio:</mat-label>
            <mat-select formControlName="municipioCtrl" (selectionChange)="selectMunicipio($event.value)" required>
              <mat-option *ngFor="let municipio of municipiosFilter" [value]="municipio.id">
                {{municipio.nombre}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field *ngIf="thirdFormGroup.controls.municipioCtrl.value != 820">
            <mat-label>Barrio donde resides:</mat-label>
            <input matInput formControlName="barrioCtrl" placeholder="Barrio donde reside" required>
          </mat-form-field>
          <mat-form-field *ngIf="thirdFormGroup.controls.municipioCtrl.value == 820">
            <mat-label>Barrio donde resides:</mat-label>
            <mat-select formControlName="barrioCtrl" required>
              <mat-option *ngFor="let barrio of barriosVillaRosarioList" [value]="barrio.nombre">
                {{barrio.nombre}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Dirección completa:</mat-label>
            <input matInput formControlName="direccionCtrl" placeholder="Dirección completa">
          </mat-form-field>
          <mat-form-field>
            <mat-label>Número de Contacto:</mat-label>
            <input matInput type="number" formControlName="numeroContactoCtrl" placeholder="Ej: 3131234567" required
                   minlength="7" maxlength="10">
          </mat-form-field>
          <div class="margin-bottom-10">
            <label>¿Esta línea de contacto es propia?*:</label>
            <mat-radio-group aria-label="Selecciona una opción" formControlName="lineaContactoPropiaCtrl"
                             (change)="lineaContactoPropia($event)" required>
              <div>
                <mat-radio-button value="si">Si</mat-radio-button>
                <mat-radio-button value="no">No</mat-radio-button>
              </div>
            </mat-radio-group>
          </div>
          <mat-form-field class="contactoAlternativo" *ngIf='contactoAlternativoInput'>
            <mat-label>¿Por quién preguntar en caso de llamar?*</mat-label>
            <input matInput formControlName="contactoAlternativoCtrl" placeholder="">
          </mat-form-field>
          <div class="margin-bottom-10" *ngIf='lineacontactoWhatsappInput'>
            <label>¿Tu línea de contacto está asociada a WhatsApp?*:</label>
            <mat-radio-group aria-label="Selecciona una opción" formControlName
              ="lineaContactoAsociadaAWhatsappCtrl" required>
              <div>
                <mat-radio-button value="si">Si</mat-radio-button>
                <mat-radio-button value="no">No</mat-radio-button>
              </div>
            </mat-radio-group>
          </div>
          <mat-form-field class="contactoAlternativo">
            <mat-label>Escribe tu correo electrónico donde te podamos contactar</mat-label>
            <input matInput formControlName="correoCtrl" placeholder="">
          </mat-form-field>
          <mat-form-field class="contactoAlternativo">
            <mat-label>
              ¿Escribe cualquier comentario adicional sobre la mejor forma o la forma preferida para contactarte?
            </mat-label>
            <input matInput formControlName="comentarioAdicionalCtrl" placeholder="">
          </mat-form-field>
          <div *ngIf="thirdFormGroup.status == 'VALID' && form===2">
            <button color="primary" mat-raised-button [disabled]="saving"
                    (click)="enviarInfo(thirdFormGroup,'paso2',stepper,true, stepper, true)">
              {{saving ? 'Guardando...' : 'Siguiente'}}
            </button>
            <p>Oprime el botón "Siguiente" para salvar la información y finalizar.</p>
          </div>
          <div *ngIf="thirdFormGroup.status == 'VALID' && form===1">
            <button color="primary" mat-raised-button [disabled]="saving"
                    (click)="enviarInfo(thirdFormGroup,'paso2',stepper,true, stepper, false)">
              {{saving ? 'Guardando...' : 'Siguiente'}}
            </button>
            <p>
              Oprime el botón "Siguiente" para salvar la información e ir al siguiente paso.
            </p>
          </div>
          <p *ngIf="thirdFormGroup.status != 'VALID'"><span class="text-red text-bold">*</span>Pregunta obligatoria</p>
          <p class="text-blue text-bold">#VenEsperanza</p>
        </form>
      </mat-step>
      <mat-step [stepControl]="fourFormGroup" *ngIf="form === 1">
        <form [formGroup]="fourFormGroup">
          <ng-template matStepLabel>DATOS DE LOS MIEMBROS DEL HOGAR</ng-template>
          <p class="text-bold">A continuación, se deben agregar los datos personales de cada miembro de tu hogar*</p>
          <div formArrayName="miembrosFamilia">
            <div *ngFor="let miembroinfo of miembrosFamilia.controls; let i = index;" class="margin-top-20">
              <div [formGroup]="miembroinfo">
                <div>
                  <label class="text-bold">{{i + 1}}. Miembro de tu hogar</label>
                </div>
                <mat-form-field>
                  <mat-label>Primer Nombre</mat-label>
                  <input matInput placeholder="Primer Nombre" formControlName="primernombreCtrl" required>
                </mat-form-field>
                <mat-form-field>
                  <mat-label>Segundo Nombre</mat-label>
                  <input matInput placeholder="Segundo Nombre" formControlName="segundonombreCtrl">
                </mat-form-field>
                <mat-form-field>
                  <mat-label>Primer Apellido</mat-label>
                  <input matInput placeholder="Primer Apellido" formControlName="primerapellidoCtrl" required>
                </mat-form-field>
                <mat-form-field>
                  <mat-label>Segundo Apellido</mat-label>
                  <input matInput placeholder="Segundo Apellido" formControlName="segundoapellidoCtrl">
                </mat-form-field>
                <div>
                  <p>Sexo*: </p>
                  <mat-radio-group aria-label="Selecciona una opción" formControlName="sexoCtrl" required
                                   (change)="seleccionSexo(i)">
                    <div>
                      <mat-radio-button value="mujer">Mujer</mat-radio-button>
                      <mat-radio-button value="hombre">Hombre</mat-radio-button>
                    </div>
                  </mat-radio-group>
                </div>
                <mat-form-field>
                  <mat-label>Fecha de Nacimiento:</mat-label>
                  <input matInput [matDatepicker]="pickertres_i" [max]="myDate" formControlName="fechaCtrl" required>
                  <mat-datepicker-toggle matSuffix [for]="pickertres_i"></mat-datepicker-toggle>
                  <mat-datepicker #pickertres_i></mat-datepicker>
                </mat-form-field>
              </div>
              <button mat-mini-fab color="warn" aria-label="Eliminar miembro" (click)="EliminarMiembro(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
          <div class="margin-top-20" *ngIf="!fourFormGroup.value.unicoMiembro">
            <label (click)="agregarNuevoMiembro()">Añade un miembro de tu hogar</label>
            <button class="margin-left-10" mat-mini-fab color="accent" aria-label="Otro miembro"
                    (click)="agregarNuevoMiembro()">
              <mat-icon>add</mat-icon>
            </button>
          </div>
          <div class="margin-bottom-10 margin-top-10" *ngIf="fourFormGroup.value.miembrosFamilia.length == 0">
            <mat-checkbox class="example-margin" color="primary" (change)="toggleMiembro($event)">
              Soy el único miembro del hogar
            </mat-checkbox>
          </div>
          <div class="margin-top-20"
               *ngIf="fourFormGroup.value.unicoMiembro || (fourFormGroup.value.miembrosFamilia.length > 0 && fourFormGroup.status == 'VALID')">
            <button color="primary" mat-raised-button [disabled]="saving"
                    (click)="enviarInfo(fourFormGroup,'paso3',stepper,true,stepper, false)">
              {{saving ? 'Guardando...' : 'Siguiente'}}
            </button>
            <p>
              Oprime el botón "Siguiente" para salvar la información e ir al siguiente paso.
            </p>
          </div>
          <p *ngIf="fourFormGroup.status != 'VALID'"><span class="text-red text-bold">*</span>Pregunta obligatoria</p>
          <p class="text-blue text-bold">#VenEsperanza</p>
        </form>
      </mat-step>
      <mat-step [stepControl]="tenFormGroup"
                *ngIf="form === 1 && secondFormGroup.value.tipoDocumentoCtrl != 'Indocumentado'">
        <form [formGroup]="tenFormGroup">
          <ng-template matStepLabel>VALIDACIÓN DE IDENTIDAD</ng-template>
          <h3>Ahora verificaremos tus datos</h3>
          <div id="mati"></div>
          <div class="margin-top-20">
            <button color="primary" mat-raised-button [disabled]="saving" (click)="finalizar()">
              {{saving ? 'Guardando...' : 'Siguiente'}}
            </button>
            <p>Oprime el botón "Siguiente" para salvar la información y finalizar.</p>
          </div>
        </form>
      </mat-step>
    </mat-vertical-stepper>
  </div>
</div>
